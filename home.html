<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fila City Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .bg-auth {
            background-image: url('https://i.ibb.co/0pXbNzn0/images.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .marquee {
            animation: marquee 15s linear infinite;
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .product-grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .product-grid-1x1 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Auth Container -->
    <div id="authContainer" class="min-h-screen bg-auth flex items-center justify-center p-4">
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl w-full max-w-md p-8">
            <!-- Login Form -->
            <div id="loginForm" class="slide-in">
                <div class="text-center mb-8">
                    <img src="https://i.ibb.co/0pXbNzn0/images.png" alt="Logo" class="w-20 h-20 mx-auto mb-4 rounded-full">
                    <h1 class="text-2xl font-bold">
                        <span class="text-blue-600">FILA</span>
                        <span class="text-red-600">CITY</span>
                        <span class="text-orange-700">SHOP</span>
                    </h1>
                    <p class="text-gray-600 mt-2">Masuk ke akun Anda</p>
                </div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Nomor HP</label>
                        <div class="flex">
                            <span class="bg-gray-200 px-3 py-2 rounded-l-lg text-gray-700">+62</span>
                            <input type="tel" id="loginPhone" class="flex-1 px-3 py-2 border border-l-0 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="8123456789" required>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="loginPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Masukkan password" required>
                            <button type="button" onclick="togglePassword('loginPassword')" class="absolute right-3 top-2.5 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300 mb-4">
                        Masuk
                    </button>
                </form>
                
                <p class="text-center text-gray-600">
                    Belum punya akun? 
                    <button onclick="showRegister()" class="text-blue-600 hover:underline">Daftar sekarang</button>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="text-center mb-6">
                    <img src="https://i.ibb.co/0pXbNzn0/images.png" alt="Logo" class="w-16 h-16 mx-auto mb-3 rounded-full">
                    <h1 class="text-xl font-bold">
                        <span class="text-blue-600">FILA</span>
                        <span class="text-red-600">CITY</span>
                        <span class="text-orange-700">SHOP</span>
                    </h1>
                    <p class="text-gray-600 mt-2">Daftar akun baru</p>
                </div>
                
                <form onsubmit="handleRegister(event)" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Nama</label>
                        <input type="text" id="regName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Umur</label>
                        <input type="number" id="regAge" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="13" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Jenis Kelamin</label>
                        <select id="regGender" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Pilih jenis kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Nomor HP</label>
                        <div class="flex">
                            <span class="bg-gray-200 px-3 py-2 rounded-l-lg text-gray-700">+62</span>
                            <input type="tel" id="regPhone" class="flex-1 px-3 py-2 border border-l-0 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="8123456789" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Email</label>
                        <input type="email" id="regEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Password</label>
                        <div class="relative">
                            <input type="password" id="regPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <button type="button" onclick="togglePassword('regPassword')" class="absolute right-3 top-2.5 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-1">Ulangi Password</label>
                        <div class="relative">
                            <input type="password" id="regConfirmPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <button type="button" onclick="togglePassword('regConfirmPassword')" class="absolute right-3 top-2.5 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        Daftar
                    </button>
                </form>
                
                <p class="text-center text-gray-600 mt-4">
                    Sudah punya akun? 
                    <button onclick="showLogin()" class="text-blue-600 hover:underline">Masuk sekarang</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="mainApp" class="hidden min-h-screen bg-gray-100">
        <!-- Header -->
        <div class="bg-white shadow-sm p-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <img id="userProfilePhoto" src="https://i.ibb.co/0pXbNzn0/images.png" alt="Profile" class="w-12 h-12 rounded-full object-cover border-2 border-gray-300 cursor-pointer" onclick="changeProfilePhoto()">
                    <div class="absolute -bottom-1 -right-1 bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs cursor-pointer" onclick="changeProfilePhoto()">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <div>
                    <h1 class="text-lg font-bold">
                        <span class="text-blue-600">FILA</span>
                        <span class="text-red-600">CITY</span>
                        <span class="text-orange-700">SHOP</span>
                    </h1>
                    <p class="text-sm text-gray-600">ID: <span id="userIdDisplay"></span></p>
                    <p class="text-xs text-gray-500" id="currentDate"></p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <button onclick="showLiveChat()" class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors relative">
                    <i class="fas fa-comments text-xl"></i>
                    <div id="chatNotification" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">
                        <span id="chatCount">0</span>
                    </div>
                </button>
                <div id="ownerSettings" class="hidden">
                    <button onclick="showOwnerSettings()" class="text-gray-600 hover:text-gray-800 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                </div>
                <button onclick="logout()" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors">
                    <i class="fas fa-sign-out-alt text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="pb-20">
            <!-- Home Tab -->
            <div id="homeTab" class="p-4 space-y-6">
                <!-- Balance, Withdrawal, Points -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Saldo</p>
                                <p class="text-2xl font-bold text-green-600">Rp <span id="userBalance">0</span></p>
                            </div>
                            <button onclick="showTopUpModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                Isi Saldo
                            </button>
                        </div>
                    </div>
                    
                    <div id="withdrawalCard" class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Penarikan</p>
                                <p class="text-lg font-semibold">Kelola Dana</p>
                            </div>
                            <button onclick="showWithdrawalModal()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                                Tarik
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Poin</p>
                                <p class="text-2xl font-bold text-purple-600"><span id="userPoints">0</span></p>
                                <p class="text-xs text-gray-500">100,000 poin = Rp 100,000</p>
                            </div>
                            <button onclick="exchangePoints()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700" id="exchangeBtn" disabled>
                                Tukar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Running Text Ad -->
                <div id="runningTextContainer" class="bg-blue-600 text-white p-3 rounded-lg overflow-hidden">
                    <div class="marquee whitespace-nowrap">
                        <span id="runningText">üéâ Selamat datang di Fila City Shop! Dapatkan produk terbaik dengan harga terjangkau! üõçÔ∏è</span>
                    </div>
                </div>

                <!-- Image Ads -->
                <div class="space-y-4" id="imageAdsContainer">
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-2">Promo Spesial!</h3>
                            <p>Dapatkan diskon hingga 50% untuk semua produk elektronik</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-2">Cashback 20%</h3>
                            <p>Untuk pembelian minimal Rp 500,000 berlaku hari ini!</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="bg-gradient-to-r from-red-500 to-pink-600 text-white p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-2">Flash Sale</h3>
                            <p>Produk pilihan dengan harga super murah, buruan sebelum kehabisan!</p>
                        </div>
                    </div>
                </div>

                <!-- Product Layout Toggle -->
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Produk</h3>
                        <div class="flex space-x-2">
                            <button onclick="setProductLayout('2x2')" id="layout2x2" class="px-3 py-1 bg-blue-600 text-white rounded text-sm">2x2</button>
                            <button onclick="setProductLayout('1x1')" id="layout1x1" class="px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm">1x1</button>
                        </div>
                    </div>
                    
                    <div id="productContainer" class="product-grid-2x2">
                        <!-- Products will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Info Data Tab -->
            <div id="infoTab" class="hidden p-4">
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="border-b">
                        <div class="flex overflow-x-auto">
                            <button onclick="showDataTab('all')" class="px-4 py-3 text-sm font-medium border-b-2 border-blue-600 text-blue-600">Semua Data</button>
                            <button onclick="showDataTab('pending')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Pending</button>
                            <button onclick="showDataTab('process')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Proses</button>
                            <button onclick="showDataTab('failed')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Gagal</button>
                            <button onclick="showDataTab('topup')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Top Up</button>
                            <button onclick="showDataTab('withdrawal')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Penarikan</button>
                            <button onclick="showDataTab('points')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">Penukaran Poin</button>
                            <button onclick="showDataTab('vip')" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">VIP Upgrade</button>
                        </div>
                    </div>
                    <div class="p-4">
                        <div id="dataContent">
                            <p class="text-gray-600 text-center py-8">Belum ada data transaksi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Balance Tab -->
            <div id="balanceTab" class="hidden p-4">
                <div class="space-y-4">
                    <!-- Member Balance Management -->
                    <div id="memberBalanceSection" class="bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Kelola Akun Bank/E-Wallet</h3>
                        <div class="space-y-4">
                            <button onclick="showBankAccountModal()" class="w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-left">
                                <i class="fas fa-university mr-3"></i>
                                Kelola Akun Bank/E-Wallet
                            </button>
                            
                            <!-- Account Limits Info -->
                            <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4">
                                <h4 class="font-medium text-purple-800 mb-2">üìä Batas Akun Berdasarkan Jenis Member</h4>
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Member:</span>
                                        <span class="font-medium">3 akun</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">VIP 1:</span>
                                        <span class="font-medium">6 akun</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">VIP 2:</span>
                                        <span class="font-medium">9 akun</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">VIP 3:</span>
                                        <span class="font-medium">12 akun</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Gold:</span>
                                        <span class="font-medium text-yellow-600">Unlimited</span>
                                    </div>
                                </div>
                                <p class="text-xs text-purple-600 mt-2">üí° Upgrade akun untuk menambah lebih banyak rekening</p>
                            </div>
                            
                            <div id="bankAccountsList" class="space-y-2">
                                <!-- Bank accounts will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Admin/Owner Balance Management -->
                    <div id="adminBalanceSection" class="hidden bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Kelola Saldo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="showMemberTopUpModal()" class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-plus-circle text-2xl mb-2"></i>
                                <p>Isi Saldo Member</p>
                            </button>
                            <button onclick="showAdminTopUpModal()" class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700" id="adminTopUpBtn">
                                <i class="fas fa-user-plus text-2xl mb-2"></i>
                                <p>Isi Saldo Admin</p>
                            </button>
                            <button onclick="showMemberWithdrawalModal()" class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700">
                                <i class="fas fa-minus-circle text-2xl mb-2"></i>
                                <p>Penarikan Member</p>
                            </button>
                            <button onclick="showSendBalanceModal()" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700">
                                <i class="fas fa-paper-plane text-2xl mb-2"></i>
                                <p>Kirim Saldo</p>
                            </button>
                        </div>
                    </div>

                    <!-- Owner User Management -->
                    <div id="ownerUserManagement" class="hidden bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Kelola User</h3>
                        <div class="space-y-4">
                            <button onclick="showAllUsersModal()" class="w-full bg-indigo-600 text-white p-4 rounded-lg hover:bg-indigo-700 text-left">
                                <i class="fas fa-users mr-3"></i>
                                Lihat & Kelola Semua User
                            </button>
                            <button onclick="showTransactionManagementModal()" class="w-full bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 text-left">
                                <i class="fas fa-exchange-alt mr-3"></i>
                                Kelola Transaksi
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Tab -->
            <div id="accountTab" class="hidden p-4">
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <h3 class="text-lg font-semibold mb-4">Profile</h3>
                    
                    <!-- Profile Section -->
                    <div class="flex items-start space-x-4 mb-6">
                        <div class="relative">
                            <img id="profilePhotoLarge" src="https://i.ibb.co/0pXbNzn0/images.png" alt="Profile" class="w-20 h-20 rounded-full object-cover border-2 border-gray-300 cursor-pointer" onclick="changeProfilePhoto()">
                            <div class="absolute -bottom-1 -right-1 bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm cursor-pointer" onclick="changeProfilePhoto()">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="flex-1 space-y-2">
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                <p><span class="font-medium text-gray-600">Nama:</span> <span id="profileName" class="font-medium"></span></p>
                                <p><span class="font-medium text-gray-600">Umur:</span> <span id="profileAge"></span></p>
                                <p><span class="font-medium text-gray-600">Jenis Kelamin:</span> <span id="profileGender"></span></p>
                            </div>
                            <hr class="my-3">
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                <p><span class="font-medium text-gray-600">Email:</span> <span id="profileEmail"></span></p>
                                <p><span class="font-medium text-gray-600">Nomor HP:</span> <span id="profilePhone"></span></p>
                                <div class="flex items-center justify-between">
                                    <span class="font-medium text-gray-600">Jenis Akun:</span>
                                    <div class="flex items-center space-x-2">
                                        <span id="profileAccountType" class="px-2 py-1 rounded text-xs font-medium"></span>
                                        <button id="changeAccountTypeBtn" onclick="showChangeAccountTypeModal()" class="hidden text-blue-600 hover:text-blue-800 text-xs">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="ownerAccountFeatures" class="hidden">
                        <button onclick="showAddAdminModal()" class="w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 mb-4">
                            <i class="fas fa-user-plus text-2xl mb-2"></i>
                            <p>Tambah Akun Admin</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t">
            <div class="flex">
                <button onclick="showTab('home')" class="flex-1 py-3 text-center border-r" id="homeNavBtn">
                    <i class="fas fa-home text-xl text-blue-600"></i>
                    <p class="text-xs text-blue-600 mt-1">Home</p>
                </button>
                <button onclick="showTab('info')" class="flex-1 py-3 text-center border-r" id="infoNavBtn">
                    <i class="fas fa-info-circle text-xl text-gray-400"></i>
                    <p class="text-xs text-gray-400 mt-1">Info Data</p>
                </button>
                <button onclick="showTab('balance')" class="flex-1 py-3 text-center border-r" id="balanceNavBtn">
                    <i class="fas fa-wallet text-xl text-gray-400"></i>
                    <p class="text-xs text-gray-400 mt-1">Saldo</p>
                </button>
                <button onclick="showTab('account')" class="flex-1 py-3 text-center" id="accountNavBtn">
                    <i class="fas fa-user text-xl text-gray-400"></i>
                    <p class="text-xs text-gray-400 mt-1">Akun</p>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Top Up Modal -->
    <div id="topUpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Isi Saldo</h3>
                <button onclick="closeModal('topUpModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="submitTopUp(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Nama</label>
                        <input type="text" id="topUpName" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">ID Member</label>
                        <input type="text" id="topUpMemberId" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nominal Top Up</label>
                        <input type="number" id="topUpAmount" class="w-full px-3 py-2 border rounded-lg" min="10000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Bukti Pembayaran</label>
                        <input type="file" id="topUpProof" class="w-full px-3 py-2 border rounded-lg" accept="image/*" required>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="closeModal('topUpModal')" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Kirim</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawalModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Penarikan Dana</h3>
                <button onclick="closeModal('withdrawalModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="submitWithdrawal(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Pilih Akun Bank/E-Wallet</label>
                        <select id="withdrawalBankAccount" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">Pilih akun</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nominal Penarikan</label>
                        <input type="number" id="withdrawalAmount" class="w-full px-3 py-2 border rounded-lg" min="50000" required>
                        <p class="text-xs text-gray-500 mt-1">Minimal penarikan Rp 50,000</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Catatan (Opsional)</label>
                        <textarea id="withdrawalNote" class="w-full px-3 py-2 border rounded-lg" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Password Login untuk Konfirmasi</label>
                        <div class="relative">
                            <input type="password" id="withdrawalPassword" class="w-full px-3 py-2 border rounded-lg" placeholder="Masukkan password login Anda" required>
                            <button type="button" onclick="togglePassword('withdrawalPassword')" class="absolute right-3 top-2.5 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <p class="text-xs text-red-500 mt-1">Untuk keamanan, masukkan password login Anda</p>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="closeModal('withdrawalModal')" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">Tarik Dana</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bank Account Modal -->
    <div id="bankAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Akun Bank/E-Wallet</h3>
                <button onclick="closeModal('bankAccountModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="addBankAccount(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Jenis Akun</label>
                        <select id="bankAccountType" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">Pilih jenis</option>
                            <option value="bank">Bank</option>
                            <option value="ewallet">E-Wallet</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nama Bank/E-Wallet</label>
                        <select id="bankAccountProvider" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">Pilih provider</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nama Pemilik Akun</label>
                        <input type="text" id="bankAccountOwner" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nomor Rekening/ID</label>
                        <input type="text" id="bankAccountNumber" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="closeModal('bankAccountModal')" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Tambah</button>
                </div>
            </form>
        </div>
    </div>

    <!-- All Users Modal (Owner Only) -->
    <div id="allUsersModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Kelola Semua User</h3>
                <button onclick="closeModal('allUsersModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="flex space-x-2 mb-4">
                    <button onclick="filterUsers('all')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm" id="filterAll">Semua</button>
                    <button onclick="filterUsers('owner')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm" id="filterOwner">Owner</button>
                    <button onclick="filterUsers('admin')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm" id="filterAdmin">Admin</button>
                    <button onclick="filterUsers('member')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm" id="filterMember">Member</button>
                </div>
                <div id="usersListContainer" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Users will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Management Modal (Owner Only) -->
    <div id="transactionManagementModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Kelola Transaksi</h3>
                <button onclick="closeModal('transactionManagementModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="flex space-x-2 mb-4 overflow-x-auto">
                    <button onclick="filterTransactions('all')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm whitespace-nowrap" id="filterAllTx">Semua</button>
                    <button onclick="filterTransactions('pending')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm whitespace-nowrap" id="filterPendingTx">Pending</button>
                    <button onclick="filterTransactions('topup')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm whitespace-nowrap" id="filterTopupTx">Top Up</button>
                    <button onclick="filterTransactions('withdrawal')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm whitespace-nowrap" id="filterWithdrawalTx">Penarikan</button>
                    <button onclick="filterTransactions('vip')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm whitespace-nowrap" id="filterVipTx">VIP</button>
                </div>
                <div id="transactionsListContainer" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Owner Settings Modal -->
    <div id="ownerSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Pengaturan Owner</h3>
                <button onclick="closeModal('ownerSettingsModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <button onclick="manageAds()" class="w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-left">
                    <i class="fas fa-bullhorn mr-3"></i>
                    Kelola Iklan
                </button>
                <button onclick="manageProducts()" class="w-full bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 text-left">
                    <i class="fas fa-box mr-3"></i>
                    Kelola Produk
                </button>
                <button onclick="managePaymentMethods()" class="w-full bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 text-left">
                    <i class="fas fa-credit-card mr-3"></i>
                    Kelola Metode Pembayaran
                </button>
                <button onclick="systemSettings()" class="w-full bg-gray-600 text-white p-4 rounded-lg hover:bg-gray-700 text-left">
                    <i class="fas fa-cogs mr-3"></i>
                    Pengaturan Sistem
                </button>
            </div>
        </div>
    </div>

    <!-- Add Admin Modal -->
    <div id="addAdminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Admin</h3>
                <button onclick="closeModal('addAdminModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="addAdmin(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Nama</label>
                        <input type="text" id="adminName" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Umur</label>
                        <input type="number" id="adminAge" class="w-full px-3 py-2 border rounded-lg" min="18" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Jenis Kelamin</label>
                        <select id="adminGender" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">Pilih jenis kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nomor HP</label>
                        <div class="flex">
                            <span class="bg-gray-200 px-3 py-2 rounded-l-lg text-gray-700">+62</span>
                            <input type="tel" id="adminPhone" class="flex-1 px-3 py-2 border border-l-0 rounded-r-lg" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Email</label>
                        <input type="email" id="adminEmail" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Password</label>
                        <div class="relative">
                            <input type="password" id="adminPassword" class="w-full px-3 py-2 border rounded-lg" required>
                            <button type="button" onclick="togglePassword('adminPassword')" class="absolute right-3 top-2.5 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Foto Profile</label>
                        <input type="file" id="adminPhoto" class="w-full px-3 py-2 border rounded-lg" accept="image/*">
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="closeModal('addAdminModal')" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Tambah</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Live Chat Modal -->
    <div id="liveChatModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg w-full max-w-md mx-4 h-96 flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-lg font-semibold">Customer Service</h3>
                <button onclick="closeModal('liveChatModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-3">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs">
                        CS
                    </div>
                    <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">Halo! Selamat datang di Fila City Shop. Ada yang bisa kami bantu?</p>
                        <p class="text-xs text-gray-500 mt-1">Admin ‚Ä¢ Sekarang</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t">
                <div class="flex space-x-2">
                    <input type="text" id="chatInput" placeholder="Ketik pesan..." class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" onkeypress="handleChatKeyPress(event)">
                    <button onclick="sendChatMessage()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Account Type Modal -->
    <div id="changeAccountTypeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Ubah Jenis Akun</h3>
                <button onclick="closeModal('changeAccountTypeModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Pilih Jenis Akun</label>
                    <select id="newAccountType" class="w-full px-3 py-2 border rounded-lg">
                        <option value="member">Member</option>
                        <option value="vip1">VIP 1</option>
                        <option value="vip2">VIP 2</option>
                        <option value="vip3">VIP 3</option>
                        <option value="gold">Gold</option>
                    </select>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-1"></i>
                        Upgrade akun memerlukan pembelian paket terlebih dahulu
                    </p>
                </div>
                <div class="flex space-x-3">
                    <button onclick="closeModal('changeAccountTypeModal')" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Batal</button>
                    <button onclick="changeAccountType()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Ubah</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for photo upload -->
    <input type="file" id="photoUpload" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">

    <script>
        // Global variables
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('filaShopUsers')) || [];
        let transactions = JSON.parse(localStorage.getItem('filaShopTransactions')) || [];
        let bankAccounts = JSON.parse(localStorage.getItem('filaShopBankAccounts')) || [];
        let products = JSON.parse(localStorage.getItem('filaShopProducts')) || [
            {id: 1, name: 'Smartphone Android', price: 2500000, stock: 10, category: 'Elektronik', image: 'üì±'},
            {id: 2, name: 'Laptop Gaming', price: 8500000, stock: 5, category: 'Elektronik', image: 'üíª'},
            {id: 3, name: 'Headphone Wireless', price: 750000, stock: 15, category: 'Audio', image: 'üéß'},
            {id: 4, name: 'Smartwatch', price: 1200000, stock: 8, category: 'Wearable', image: '‚åö'}
        ];
        let currentLayout = '2x2';
        let nextUserId = parseInt(localStorage.getItem('filaShopNextUserId')) || 1;

        // Initialize owner account if not exists
        if (!users.find(u => u.role === 'owner')) {
            users.push({
                id: 'OWN001',
                name: 'Owner Fila city',
                age: 30,
                gender: 'Laki-laki',
                phone: '89646775883',
                email: 'owner@filacityshop.com',
                password: '1020',
                role: 'owner',
                balance: 0,
                points: 0,
                createdAt: new Date().toISOString()
            });
            saveUsers();
        }

        // Authentication functions
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('slide-in');
        }

        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('slide-in');
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('regName').value;
            const age = document.getElementById('regAge').value;
            const gender = document.getElementById('regGender').value;
            const phone = document.getElementById('regPhone').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('Password tidak cocok!');
                return;
            }

            if (users.find(u => u.phone === phone)) {
                alert('Nomor HP sudah terdaftar!');
                return;
            }

            if (users.find(u => u.email === email)) {
                alert('Email sudah terdaftar!');
                return;
            }

            const userId = nextUserId.toString().padStart(4, '0');
            const newUser = {
                id: userId,
                name,
                age: parseInt(age),
                gender,
                phone,
                email,
                password,
                role: 'member',
                balance: 0,
                points: 0,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            nextUserId++;
            saveUsers();
            localStorage.setItem('filaShopNextUserId', nextUserId.toString());

            alert('Registrasi berhasil! Silakan login.');
            showLogin();
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.phone === phone && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('filaShopCurrentUser', JSON.stringify(user));
                showMainApp();
            } else {
                alert('Nomor HP atau password salah!');
            }
        }

        function showMainApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            updateUserDisplay();
            updateCurrentDate();
            showTab('home');
            loadProducts();
            setupRoleBasedAccess();
            loadBankAccounts();
        }

        function setupRoleBasedAccess() {
            // Hide all role-specific elements first
            document.getElementById('ownerSettings').classList.add('hidden');
            document.getElementById('ownerAccountFeatures').classList.add('hidden');
            document.getElementById('adminBalanceSection').classList.add('hidden');
            document.getElementById('ownerUserManagement').classList.add('hidden');
            document.getElementById('memberBalanceSection').classList.add('hidden');

            // Show elements based on role
            if (currentUser.role === 'owner') {
                document.getElementById('ownerSettings').classList.remove('hidden');
                document.getElementById('ownerAccountFeatures').classList.remove('hidden');
                document.getElementById('adminBalanceSection').classList.remove('hidden');
                document.getElementById('ownerUserManagement').classList.remove('hidden');
            } else if (currentUser.role === 'admin') {
                document.getElementById('adminBalanceSection').classList.remove('hidden');
            } else if (currentUser.role === 'member') {
                document.getElementById('memberBalanceSection').classList.remove('hidden');
            }
        }

        function updateUserDisplay() {
            document.getElementById('userIdDisplay').textContent = currentUser.id;
            document.getElementById('userBalance').textContent = formatCurrency(currentUser.balance);
            document.getElementById('userPoints').textContent = formatNumber(currentUser.points);
            
            // Update profile info
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileAge').textContent = currentUser.age;
            document.getElementById('profileGender').textContent = currentUser.gender;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profilePhone').textContent = '+62' + currentUser.phone;
            
            // Update profile photos
            const profilePhoto = currentUser.profilePhoto || 'https://i.ibb.co/0pXbNzn0/images.png';
            document.getElementById('userProfilePhoto').src = profilePhoto;
            document.getElementById('profilePhotoLarge').src = profilePhoto;
            
            // Update account type
            const accountType = currentUser.accountType || currentUser.role;
            const accountTypeElement = document.getElementById('profileAccountType');
            accountTypeElement.textContent = getAccountTypeLabel(accountType);
            accountTypeElement.className = `px-2 py-1 rounded text-xs font-medium ${getAccountTypeColor(accountType)}`;
            
            // Show change account type button only for owner
            if (currentUser.role === 'owner') {
                document.getElementById('changeAccountTypeBtn').classList.remove('hidden');
            }
            
            // Update exchange button
            const exchangeBtn = document.getElementById('exchangeBtn');
            if (currentUser.points >= 100000) {
                exchangeBtn.disabled = false;
                exchangeBtn.classList.remove('opacity-50');
            } else {
                exchangeBtn.disabled = true;
                exchangeBtn.classList.add('opacity-50');
            }
        }

        function getAccountTypeLabel(type) {
            const labels = {
                'owner': 'OWNER APPS',
                'admin': 'ADMIN APPS',
                'member': 'MEMBER',
                'vip1': 'VIP 1',
                'vip2': 'VIP 2',
                'vip3': 'VIP 3',
                'gold': 'GOLD'
            };
            return labels[type] || 'MEMBER';
        }

        function getAccountTypeColor(type) {
            const colors = {
                'owner': 'bg-purple-100 text-purple-800',
                'admin': 'bg-blue-100 text-blue-800',
                'member': 'bg-gray-100 text-gray-800',
                'vip1': 'bg-green-100 text-green-800',
                'vip2': 'bg-yellow-100 text-yellow-800',
                'vip3': 'bg-orange-100 text-orange-800',
                'gold': 'bg-yellow-200 text-yellow-900'
            };
            return colors[type] || 'bg-gray-100 text-gray-800';
        }

        function updateCurrentDate() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            
            document.getElementById('currentDate').textContent = `${dayName}, ${date} ${month} ${year}`;
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('filaShopCurrentUser');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
            showLogin();
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.getElementById('homeTab').classList.add('hidden');
            document.getElementById('infoTab').classList.add('hidden');
            document.getElementById('balanceTab').classList.add('hidden');
            document.getElementById('accountTab').classList.add('hidden');

            // Reset nav buttons
            const navButtons = ['homeNavBtn', 'infoNavBtn', 'balanceNavBtn', 'accountNavBtn'];
            navButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                const icon = btn.querySelector('i');
                const text = btn.querySelector('p');
                icon.className = icon.className.replace('text-blue-600', 'text-gray-400');
                text.className = text.className.replace('text-blue-600', 'text-gray-400');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Update nav button
            const activeBtn = document.getElementById(tabName + 'NavBtn');
            const activeIcon = activeBtn.querySelector('i');
            const activeText = activeBtn.querySelector('p');
            activeIcon.className = activeIcon.className.replace('text-gray-400', 'text-blue-600');
            activeText.className = activeText.className.replace('text-gray-400', 'text-blue-600');
        }

        // Product functions
        function loadProducts() {
            const container = document.getElementById('productContainer');
            container.innerHTML = '';

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-lg p-4 shadow-sm border';
                productCard.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">${product.image}</div>
                        <h4 class="font-medium text-sm mb-1">${product.name}</h4>
                        <p class="text-blue-600 font-bold text-sm mb-2">Rp ${formatCurrency(product.price)}</p>
                        <p class="text-xs text-gray-500 mb-3">Stok: ${product.stock}</p>
                        <button onclick="buyProduct(${product.id})" class="w-full bg-blue-600 text-white py-2 px-3 rounded text-xs hover:bg-blue-700 ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${product.stock === 0 ? 'disabled' : ''}>
                            ${product.stock === 0 ? 'Habis' : 'Beli'}
                        </button>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function setProductLayout(layout) {
            currentLayout = layout;
            const container = document.getElementById('productContainer');
            const btn2x2 = document.getElementById('layout2x2');
            const btn1x1 = document.getElementById('layout1x1');

            if (layout === '2x2') {
                container.className = 'product-grid-2x2';
                btn2x2.className = 'px-3 py-1 bg-blue-600 text-white rounded text-sm';
                btn1x1.className = 'px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm';
            } else {
                container.className = 'product-grid-1x1';
                btn1x1.className = 'px-3 py-1 bg-blue-600 text-white rounded text-sm';
                btn2x2.className = 'px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm';
            }
        }

        function buyProduct(productId) {
            if (currentUser.role !== 'member') {
                alert('Hanya member yang dapat membeli produk!');
                return;
            }

            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                alert('Produk tidak tersedia!');
                return;
            }

            if (currentUser.balance < product.price) {
                alert('Saldo tidak mencukupi!');
                return;
            }

            if (confirm(`Beli ${product.name} seharga Rp ${formatCurrency(product.price)}?`)) {
                // Deduct balance and add points
                currentUser.balance -= product.price;
                currentUser.points += 2;
                
                // Reduce stock
                product.stock--;
                
                // Add transaction
                const transaction = {
                    id: Date.now(),
                    userId: currentUser.id,
                    type: 'purchase',
                    productId: product.id,
                    productName: product.name,
                    amount: product.price,
                    status: 'success',
                    createdAt: new Date().toISOString()
                };
                transactions.push(transaction);

                // Update user in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                users[userIndex] = currentUser;

                saveUsers();
                saveProducts();
                saveTransactions();
                updateUserDisplay();
                loadProducts();

                alert('Pembelian berhasil! Anda mendapat 2 poin.');
            }
        }

        // Bank Account Management
        function showBankAccountModal() {
            // Reset modal for add mode
            document.querySelector('#bankAccountModal h3').textContent = 'Tambah Akun Bank/E-Wallet';
            document.querySelector('#bankAccountModal button[type="submit"]').textContent = 'Tambah';
            document.getElementById('bankAccountModal').removeAttribute('data-edit-id');
            
            // Clear form
            document.getElementById('bankAccountType').value = '';
            document.getElementById('bankAccountProvider').innerHTML = '<option value="">Pilih provider</option>';
            document.getElementById('bankAccountOwner').value = '';
            document.getElementById('bankAccountNumber').value = '';
            
            document.getElementById('bankAccountModal').classList.remove('hidden');
            document.getElementById('bankAccountModal').classList.add('flex');
            
            // Setup bank account type change handler
            document.getElementById('bankAccountType').onchange = function() {
                const type = this.value;
                const providerSelect = document.getElementById('bankAccountProvider');
                providerSelect.innerHTML = '<option value="">Pilih provider</option>';
                
                if (type === 'ewallet') {
                    const ewallets = ['DANA', 'GoPay', 'ShopeePay', 'OVO', 'LinkAja'];
                    ewallets.forEach(wallet => {
                        providerSelect.innerHTML += `<option value="${wallet}">${wallet}</option>`;
                    });
                } else if (type === 'bank') {
                    const banks = ['BRI', 'Mandiri', 'BSI', 'BNI', 'Seabank', 'Neo Bank', 'BCA', 'CIMB Niaga', 'Danamon', 'Permata'];
                    banks.forEach(bank => {
                        providerSelect.innerHTML += `<option value="${bank}">${bank}</option>`;
                    });
                }
            };
        }

        function addBankAccount(event) {
            event.preventDefault();
            
            const modal = document.getElementById('bankAccountModal');
            const editId = modal.getAttribute('data-edit-id');
            
            if (editId) {
                // Edit mode
                const accountIndex = bankAccounts.findIndex(acc => acc.id == editId);
                if (accountIndex !== -1) {
                    bankAccounts[accountIndex] = {
                        ...bankAccounts[accountIndex],
                        type: document.getElementById('bankAccountType').value,
                        provider: document.getElementById('bankAccountProvider').value,
                        ownerName: document.getElementById('bankAccountOwner').value,
                        accountNumber: document.getElementById('bankAccountNumber').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    saveBankAccounts();
                    loadBankAccounts();
                    closeModal('bankAccountModal');
                    
                    alert('Akun bank/e-wallet berhasil diupdate!');
                }
            } else {
                // Add mode - Check account limits
                const userBankAccounts = bankAccounts.filter(acc => acc.userId === currentUser.id);
                const accountLimits = getAccountLimits(currentUser.accountType || currentUser.role);
                
                if (accountLimits.limit !== 'unlimited' && userBankAccounts.length >= accountLimits.limit) {
                    alert(`Batas maksimal akun bank/e-wallet untuk ${accountLimits.name} adalah ${accountLimits.limit} akun.\n\nUpgrade akun Anda untuk menambah lebih banyak rekening!`);
                    return;
                }
                
                const bankAccount = {
                    id: Date.now(),
                    userId: currentUser.id,
                    type: document.getElementById('bankAccountType').value,
                    provider: document.getElementById('bankAccountProvider').value,
                    ownerName: document.getElementById('bankAccountOwner').value,
                    accountNumber: document.getElementById('bankAccountNumber').value,
                    createdAt: new Date().toISOString()
                };
                
                bankAccounts.push(bankAccount);
                saveBankAccounts();
                loadBankAccounts();
                closeModal('bankAccountModal');
                
                alert('Akun bank/e-wallet berhasil ditambahkan!');
            }
        }

        function getAccountLimits(accountType) {
            const limits = {
                'member': { name: 'Member', limit: 3 },
                'vip1': { name: 'VIP 1', limit: 6 },
                'vip2': { name: 'VIP 2', limit: 9 },
                'vip3': { name: 'VIP 3', limit: 12 },
                'gold': { name: 'Gold', limit: 'unlimited' },
                'admin': { name: 'Admin', limit: 'unlimited' },
                'owner': { name: 'Owner', limit: 'unlimited' }
            };
            return limits[accountType] || limits['member'];
        }

        function loadBankAccounts() {
            const userBankAccounts = bankAccounts.filter(acc => acc.userId === currentUser.id);
            const container = document.getElementById('bankAccountsList');
            const withdrawalSelect = document.getElementById('withdrawalBankAccount');
            const accountLimits = getAccountLimits(currentUser.accountType || currentUser.role);
            
            container.innerHTML = '';
            withdrawalSelect.innerHTML = '<option value="">Pilih akun</option>';
            
            // Add account status info
            const statusInfo = document.createElement('div');
            statusInfo.className = 'bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3';
            statusInfo.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-blue-800">
                        <i class="fas fa-info-circle mr-1"></i>
                        Akun tersimpan: ${userBankAccounts.length}/${accountLimits.limit === 'unlimited' ? '‚àû' : accountLimits.limit}
                    </span>
                    ${accountLimits.limit !== 'unlimited' && userBankAccounts.length >= accountLimits.limit ? 
                        '<span class="text-xs text-red-600 font-medium">Batas Tercapai</span>' : 
                        '<span class="text-xs text-green-600 font-medium">Dapat Menambah</span>'
                    }
                </div>
            `;
            container.appendChild(statusInfo);
            
            if (userBankAccounts.length === 0) {
                const emptyMsg = document.createElement('p');
                emptyMsg.className = 'text-gray-500 text-sm';
                emptyMsg.textContent = 'Belum ada akun bank/e-wallet yang terdaftar';
                container.appendChild(emptyMsg);
                return;
            }
            
            userBankAccounts.forEach(account => {
                // Add to list display
                const accountElement = document.createElement('div');
                accountElement.className = 'bg-gray-50 p-3 rounded-lg flex justify-between items-center';
                accountElement.innerHTML = `
                    <div>
                        <p class="font-medium text-sm">${account.provider}</p>
                        <p class="text-xs text-gray-600">${account.ownerName}</p>
                        <p class="text-xs text-gray-500">${account.accountNumber}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editBankAccount(${account.id})" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-edit text-sm"></i>
                        </button>
                        <button onclick="deleteBankAccount(${account.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
                container.appendChild(accountElement);
                
                // Add to withdrawal select
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = `${account.provider} - ${account.ownerName} (${account.accountNumber})`;
                withdrawalSelect.appendChild(option);
            });
        }

        function editBankAccount(accountId) {
            const account = bankAccounts.find(acc => acc.id === accountId);
            if (!account) return;
            
            // Fill form with existing data
            document.getElementById('bankAccountType').value = account.type;
            
            // Trigger provider options update
            const event = new Event('change');
            document.getElementById('bankAccountType').dispatchEvent(event);
            
            setTimeout(() => {
                document.getElementById('bankAccountProvider').value = account.provider;
                document.getElementById('bankAccountOwner').value = account.ownerName;
                document.getElementById('bankAccountNumber').value = account.accountNumber;
            }, 100);
            
            // Change modal title and button
            document.querySelector('#bankAccountModal h3').textContent = 'Edit Akun Bank/E-Wallet';
            document.querySelector('#bankAccountModal button[type="submit"]').textContent = 'Update';
            
            // Store edit mode
            document.getElementById('bankAccountModal').setAttribute('data-edit-id', accountId);
            
            // Show modal
            document.getElementById('bankAccountModal').classList.remove('hidden');
            document.getElementById('bankAccountModal').classList.add('flex');
        }

        function deleteBankAccount(accountId) {
            if (confirm('Hapus akun bank/e-wallet ini?')) {
                bankAccounts = bankAccounts.filter(acc => acc.id !== accountId);
                saveBankAccounts();
                loadBankAccounts();
                alert('Akun berhasil dihapus!');
            }
        }

        // Modal functions
        function showTopUpModal() {
            document.getElementById('topUpName').value = currentUser.name;
            document.getElementById('topUpMemberId').value = currentUser.id;
            document.getElementById('topUpModal').classList.remove('hidden');
            document.getElementById('topUpModal').classList.add('flex');
        }

        function showWithdrawalModal() {
            const userBankAccounts = bankAccounts.filter(acc => acc.userId === currentUser.id);
            
            if (userBankAccounts.length === 0) {
                alert('Anda belum memiliki akun bank/e-wallet. Silakan tambahkan terlebih dahulu di tab Saldo.');
                return;
            }
            
            document.getElementById('withdrawalModal').classList.remove('hidden');
            document.getElementById('withdrawalModal').classList.add('flex');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        function submitTopUp(event) {
            event.preventDefault();
            
            const transaction = {
                id: Date.now(),
                userId: currentUser.id,
                type: 'topup',
                name: document.getElementById('topUpName').value,
                memberId: document.getElementById('topUpMemberId').value,
                amount: parseInt(document.getElementById('topUpAmount').value),
                proof: 'uploaded', // In real app, handle file upload
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveTransactions();
            
            alert('Permintaan top up berhasil dikirim! Menunggu konfirmasi admin.');
            closeModal('topUpModal');
        }

        function submitWithdrawal(event) {
            event.preventDefault();
            
            const password = document.getElementById('withdrawalPassword').value;
            const amount = parseInt(document.getElementById('withdrawalAmount').value);
            const bankAccountId = document.getElementById('withdrawalBankAccount').value;
            
            // Verify password
            if (password !== currentUser.password) {
                alert('Password salah! Penarikan dibatalkan.');
                return;
            }
            
            if (currentUser.balance < amount) {
                alert('Saldo tidak mencukupi!');
                return;
            }
            
            const selectedBankAccount = bankAccounts.find(acc => acc.id == bankAccountId);
            
            const transaction = {
                id: Date.now(),
                userId: currentUser.id,
                type: 'withdrawal',
                amount: amount,
                bankAccount: selectedBankAccount,
                note: document.getElementById('withdrawalNote').value,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveTransactions();
            
            alert('Permintaan penarikan berhasil dikirim! Menunggu konfirmasi admin.');
            closeModal('withdrawalModal');
        }

        function exchangePoints() {
            if (currentUser.points < 100000) {
                alert('Poin minimal 100,000 untuk ditukar!');
                return;
            }
            
            if (confirm('Tukar 100,000 poin menjadi Rp 100,000?')) {
                currentUser.points -= 100000;
                currentUser.balance += 100000;
                
                const transaction = {
                    id: Date.now(),
                    userId: currentUser.id,
                    type: 'point_exchange',
                    points: 100000,
                    amount: 100000,
                    status: 'success',
                    createdAt: new Date().toISOString()
                };
                
                transactions.push(transaction);
                
                // Update user in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                users[userIndex] = currentUser;
                
                saveUsers();
                saveTransactions();
                updateUserDisplay();
                
                alert('Penukaran poin berhasil!');
            }
        }

        // Owner/Admin Management Functions
        function showAllUsersModal() {
            if (currentUser.role !== 'owner') {
                alert('Hanya owner yang dapat mengakses fitur ini!');
                return;
            }
            
            document.getElementById('allUsersModal').classList.remove('hidden');
            document.getElementById('allUsersModal').classList.add('flex');
            filterUsers('all');
        }

        function filterUsers(role) {
            // Update filter buttons
            const filterButtons = ['filterAll', 'filterOwner', 'filterAdmin', 'filterMember'];
            filterButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm';
            });
            
            const activeBtn = document.getElementById('filter' + role.charAt(0).toUpperCase() + role.slice(1));
            if (activeBtn) {
                activeBtn.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg text-sm';
            }
            
            // Filter and display users
            let filteredUsers = users;
            if (role !== 'all') {
                filteredUsers = users.filter(u => u.role === role);
            }
            
            const container = document.getElementById('usersListContainer');
            container.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'bg-gray-50 p-4 rounded-lg';
                userElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium">${user.name}</p>
                            <p class="text-sm text-gray-600">ID: ${user.id} | ${user.role.toUpperCase()}</p>
                            <p class="text-sm text-gray-600">HP: +62${user.phone}</p>
                            <p class="text-sm text-gray-600">Saldo: Rp ${formatCurrency(user.balance)}</p>
                            <p class="text-xs text-gray-500">Bergabung: ${new Date(user.createdAt).toLocaleDateString('id-ID')}</p>
                        </div>
                        <div class="flex space-x-2">
                            ${user.role !== 'owner' ? `
                                <button onclick="editUserBalance('${user.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(userElement);
            });
        }

        function editUserBalance(userId) {
            const user = users.find(u => u.id === userId);
            const newBalance = prompt(`Ubah saldo ${user.name} (saat ini: Rp ${formatCurrency(user.balance)}):`, user.balance);
            
            if (newBalance !== null && !isNaN(newBalance)) {
                user.balance = parseInt(newBalance);
                saveUsers();
                filterUsers('all'); // Refresh display
                alert('Saldo berhasil diubah!');
            }
        }

        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            if (confirm(`Hapus user ${user.name}? Tindakan ini tidak dapat dibatalkan.`)) {
                users = users.filter(u => u.id !== userId);
                saveUsers();
                filterUsers('all'); // Refresh display
                alert('User berhasil dihapus!');
            }
        }

        function showTransactionManagementModal() {
            if (currentUser.role !== 'owner') {
                alert('Hanya owner yang dapat mengakses fitur ini!');
                return;
            }
            
            document.getElementById('transactionManagementModal').classList.remove('hidden');
            document.getElementById('transactionManagementModal').classList.add('flex');
            filterTransactions('all');
        }

        function filterTransactions(type) {
            // Update filter buttons
            const filterButtons = ['filterAllTx', 'filterPendingTx', 'filterTopupTx', 'filterWithdrawalTx', 'filterVipTx'];
            filterButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm whitespace-nowrap';
            });
            
            const activeBtn = document.getElementById('filter' + type.charAt(0).toUpperCase() + type.slice(1) + 'Tx');
            if (activeBtn) {
                activeBtn.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg text-sm whitespace-nowrap';
            }
            
            // Filter and display transactions
            let filteredTransactions = transactions;
            if (type === 'pending') {
                filteredTransactions = transactions.filter(t => t.status === 'pending');
            } else if (type === 'topup') {
                filteredTransactions = transactions.filter(t => t.type === 'topup');
            } else if (type === 'withdrawal') {
                filteredTransactions = transactions.filter(t => t.type === 'withdrawal');
            } else if (type === 'vip') {
                filteredTransactions = transactions.filter(t => t.type === 'vip_purchase');
            }
            
            const container = document.getElementById('transactionsListContainer');
            container.innerHTML = '';
            
            filteredTransactions.forEach(transaction => {
                const user = users.find(u => u.id === transaction.userId);
                const transactionElement = document.createElement('div');
                transactionElement.className = 'bg-gray-50 p-4 rounded-lg';
                transactionElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium">${getTransactionTitle(transaction)}</p>
                            <p class="text-sm text-gray-600">User: ${user ? user.name : 'Unknown'} (${transaction.userId})</p>
                            <p class="text-sm text-gray-600">Jumlah: Rp ${formatCurrency(transaction.amount)}</p>
                            <p class="text-xs text-gray-500">${new Date(transaction.createdAt).toLocaleString('id-ID')}</p>
                            ${transaction.bankAccount ? `
                                <p class="text-xs text-gray-500">Ke: ${transaction.bankAccount.provider} - ${transaction.bankAccount.ownerName}</p>
                            ` : ''}
                        </div>
                        <div class="flex flex-col space-y-1">
                            <span class="text-xs px-2 py-1 rounded ${getStatusColor(transaction.status)}">
                                ${transaction.status.toUpperCase()}
                            </span>
                            ${transaction.status === 'pending' ? `
                                <button onclick="approveTransaction(${transaction.id})" class="text-green-600 hover:text-green-800 text-xs">
                                    Setujui
                                </button>
                                <button onclick="rejectTransaction(${transaction.id})" class="text-red-600 hover:text-red-800 text-xs">
                                    Tolak
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(transactionElement);
            });
        }

        function approveTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            const user = users.find(u => u.id === transaction.userId);
            
            if (transaction.type === 'topup') {
                user.balance += transaction.amount;
                transaction.status = 'success';
            } else if (transaction.type === 'withdrawal') {
                if (user.balance >= transaction.amount) {
                    user.balance -= transaction.amount;
                    transaction.status = 'success';
                } else {
                    alert('Saldo user tidak mencukupi!');
                    return;
                }
            } else if (transaction.type === 'vip_purchase') {
                if (user.balance >= transaction.amount) {
                    // Deduct balance
                    user.balance -= transaction.amount;
                    
                    // Add bonus points
                    user.points += transaction.bonusPoints;
                    
                    // Upgrade account type
                    user.accountType = transaction.vipType;
                    
                    transaction.status = 'success';
                    
                    alert(`VIP upgrade berhasil disetujui!\n\nUser ${user.name} telah diupgrade ke ${transaction.vipName}.\n‚Ä¢ Saldo dipotong: Rp ${formatCurrency(transaction.amount)}\n‚Ä¢ Poin bonus: ${formatNumber(transaction.bonusPoints)}`);
                } else {
                    alert('Saldo user tidak mencukupi untuk upgrade VIP!');
                    return;
                }
            }
            
            saveUsers();
            saveTransactions();
            filterTransactions('pending'); // Refresh display
            
            if (transaction.type !== 'vip_purchase') {
                alert('Transaksi berhasil disetujui!');
            }
        }

        function rejectTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            transaction.status = 'failed';
            
            saveTransactions();
            filterTransactions('pending'); // Refresh display
            alert('Transaksi ditolak!');
        }

        // Data functions
        function showDataTab(type) {
            // Update tab buttons
            const tabButtons = document.querySelectorAll('#infoTab .border-b button');
            tabButtons.forEach(btn => {
                btn.className = 'px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800';
            });
            
            event.target.className = 'px-4 py-3 text-sm font-medium border-b-2 border-blue-600 text-blue-600';
            
            // Filter and display data based on role
            let filteredTransactions = [];
            
            if (currentUser.role === 'owner') {
                filteredTransactions = transactions; // Owner sees all
            } else if (currentUser.role === 'admin') {
                filteredTransactions = transactions.filter(t => t.userId !== 'OWN001'); // Admin sees all except owner
            } else {
                filteredTransactions = transactions.filter(t => t.userId === currentUser.id); // Member sees only their own
            }
            
            if (type !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => {
                    switch(type) {
                        case 'pending': return t.status === 'pending';
                        case 'process': return t.status === 'process';
                        case 'failed': return t.status === 'failed';
                        case 'topup': return t.type === 'topup';
                        case 'withdrawal': return t.type === 'withdrawal';
                        case 'points': return t.type === 'point_exchange';
                        case 'vip': return t.type === 'vip_purchase';
                        default: return true;
                    }
                });
            }
            
            displayTransactions(filteredTransactions);
        }

        function displayTransactions(transactions) {
            const container = document.getElementById('dataContent');
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center py-8">Belum ada data transaksi</p>';
                return;
            }
            
            container.innerHTML = transactions.map(t => {
                const user = users.find(u => u.id === t.userId);
                return `
                    <div class="border-b pb-3 mb-3 last:border-b-0">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium">${getTransactionTitle(t)}</p>
                                ${currentUser.role !== 'member' ? `<p class="text-sm text-gray-600">User: ${user ? user.name : 'Unknown'} (${t.userId})</p>` : ''}
                                <p class="text-sm text-gray-600">${new Date(t.createdAt).toLocaleString('id-ID')}</p>
                                ${t.bankAccount ? `<p class="text-xs text-gray-500">Ke: ${t.bankAccount.provider} - ${t.bankAccount.ownerName}</p>` : ''}
                            </div>
                            <div class="text-right">
                                <p class="font-bold ${t.type === 'withdrawal' ? 'text-red-600' : 'text-green-600'}">
                                    ${t.type === 'withdrawal' ? '-' : '+'}Rp ${formatCurrency(t.amount)}
                                </p>
                                <span class="text-xs px-2 py-1 rounded ${getStatusColor(t.status)}">
                                    ${t.status.toUpperCase()}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTransactionTitle(transaction) {
            switch(transaction.type) {
                case 'topup': return 'Top Up Saldo';
                case 'withdrawal': return 'Penarikan Dana';
                case 'purchase': return `Pembelian ${transaction.productName}`;
                case 'point_exchange': return 'Penukaran Poin';
                case 'vip_purchase': return `Upgrade ke ${transaction.vipName}`;
                default: return 'Transaksi';
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'process': return 'bg-blue-100 text-blue-800';
                case 'success': return 'bg-green-100 text-green-800';
                case 'failed': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID').format(amount);
        }

        function formatNumber(number) {
            return new Intl.NumberFormat('id-ID').format(number);
        }

        function saveUsers() {
            localStorage.setItem('filaShopUsers', JSON.stringify(users));
        }

        function saveProducts() {
            localStorage.setItem('filaShopProducts', JSON.stringify(products));
        }

        function saveTransactions() {
            localStorage.setItem('filaShopTransactions', JSON.stringify(transactions));
        }

        function saveBankAccounts() {
            localStorage.setItem('filaShopBankAccounts', JSON.stringify(bankAccounts));
        }

        // Owner settings functions
        function showOwnerSettings() {
            document.getElementById('ownerSettingsModal').classList.remove('hidden');
            document.getElementById('ownerSettingsModal').classList.add('flex');
        }

        function manageAds() {
            alert('Fitur kelola iklan akan segera hadir!');
            closeModal('ownerSettingsModal');
        }

        function manageProducts() {
            alert('Fitur kelola produk akan segera hadir!');
            closeModal('ownerSettingsModal');
        }

        function managePaymentMethods() {
            alert('Fitur kelola metode pembayaran akan segera hadir!');
            closeModal('ownerSettingsModal');
        }

        function systemSettings() {
            alert('Fitur pengaturan sistem akan segera hadir!');
            closeModal('ownerSettingsModal');
        }

        function addAdmin(event) {
            event.preventDefault();
            
            if (currentUser.role !== 'owner') {
                alert('Hanya owner yang dapat menambah admin!');
                return;
            }
            
            const phone = document.getElementById('adminPhone').value;
            const email = document.getElementById('adminEmail').value;
            
            if (users.find(u => u.phone === phone)) {
                alert('Nomor HP sudah terdaftar!');
                return;
            }
            
            if (users.find(u => u.email === email)) {
                alert('Email sudah terdaftar!');
                return;
            }
            
            // Generate admin ID
            const adminCount = users.filter(u => u.role === 'admin').length;
            const adminId = 'ADM' + (adminCount + 1).toString().padStart(3, '0');
            
            const newAdmin = {
                id: adminId,
                name: document.getElementById('adminName').value,
                age: parseInt(document.getElementById('adminAge').value),
                gender: document.getElementById('adminGender').value,
                phone: phone,
                email: email,
                password: document.getElementById('adminPassword').value,
                role: 'admin',
                balance: 0,
                points: 0,
                createdAt: new Date().toISOString()
            };
            
            users.push(newAdmin);
            saveUsers();
            
            alert('Admin berhasil ditambahkan!');
            closeModal('addAdminModal');
        }

        // Photo upload functions
        function changeProfilePhoto() {
            document.getElementById('photoUpload').click();
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = e.target.result;
                    currentUser.profilePhoto = photoData;
                    
                    // Update user in users array
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    users[userIndex] = currentUser;
                    
                    saveUsers();
                    updateUserDisplay();
                    
                    alert('Foto profil berhasil diubah!');
                };
                reader.readAsDataURL(file);
            }
        }

        // Live chat functions
        let chatMessages = JSON.parse(localStorage.getItem('filaShopChatMessages')) || [];

        function showLiveChat() {
            document.getElementById('liveChatModal').classList.remove('hidden');
            document.getElementById('liveChatModal').classList.add('flex');
            loadChatMessages();
        }

        function loadChatMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            
            // Add welcome message
            const welcomeMsg = document.createElement('div');
            welcomeMsg.className = 'flex items-start space-x-2';
            welcomeMsg.innerHTML = `
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs">
                    CS
                </div>
                <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                    <p class="text-sm">Halo! Selamat datang di Fila City Shop. Ada yang bisa kami bantu?</p>
                    <p class="text-xs text-gray-500 mt-1">Admin ‚Ä¢ Sekarang</p>
                </div>
            `;
            container.appendChild(welcomeMsg);
            
            // Add user messages
            chatMessages.forEach(msg => {
                const msgElement = document.createElement('div');
                msgElement.className = `flex items-start space-x-2 ${msg.sender === currentUser.id ? 'flex-row-reverse' : ''}`;
                
                const isUser = msg.sender === currentUser.id;
                msgElement.innerHTML = `
                    <div class="w-8 h-8 ${isUser ? 'bg-green-600' : 'bg-blue-600'} rounded-full flex items-center justify-center text-white text-xs">
                        ${isUser ? 'U' : 'CS'}
                    </div>
                    <div class="${isUser ? 'bg-blue-600 text-white' : 'bg-gray-100'} rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${msg.message}</p>
                        <p class="text-xs ${isUser ? 'text-blue-100' : 'text-gray-500'} mt-1">${msg.senderName} ‚Ä¢ ${new Date(msg.timestamp).toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</p>
                    </div>
                `;
                container.appendChild(msgElement);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessage = {
                    id: Date.now(),
                    sender: currentUser.id,
                    senderName: currentUser.name,
                    message: message,
                    timestamp: new Date().toISOString()
                };
                
                chatMessages.push(chatMessage);
                localStorage.setItem('filaShopChatMessages', JSON.stringify(chatMessages));
                
                input.value = '';
                loadChatMessages();
                
                // Simulate admin response after 2 seconds
                setTimeout(() => {
                    const adminResponse = {
                        id: Date.now(),
                        sender: 'admin',
                        senderName: 'Admin',
                        message: 'Terima kasih atas pesan Anda. Tim kami akan segera membantu Anda.',
                        timestamp: new Date().toISOString()
                    };
                    
                    chatMessages.push(adminResponse);
                    localStorage.setItem('filaShopChatMessages', JSON.stringify(chatMessages));
                    loadChatMessages();
                }, 2000);
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        // VIP Upgrade functions
        function showUpgradeModal() {
            if (currentUser.role !== 'member') {
                alert('Fitur upgrade VIP hanya tersedia untuk member!');
                return;
            }
            
            document.getElementById('currentBalanceUpgrade').textContent = formatCurrency(currentUser.balance);
            document.getElementById('upgradeModal').classList.remove('hidden');
            document.getElementById('upgradeModal').classList.add('flex');
        }

        function purchaseVIP(vipType, price, bonusPoints) {
            if (currentUser.balance < price) {
                alert(`Saldo tidak mencukupi! Anda memerlukan Rp ${formatCurrency(price)} untuk upgrade ke ${getAccountTypeLabel(vipType)}.`);
                return;
            }
            
            const vipName = getAccountTypeLabel(vipType);
            if (confirm(`Beli paket ${vipName} seharga Rp ${formatCurrency(price)}?\n\nAnda akan mendapat:\n‚Ä¢ ${vipName} status\n‚Ä¢ ${formatNumber(bonusPoints)} poin bonus\n‚Ä¢ Batas akun bank sesuai paket\n\nPembelian memerlukan konfirmasi Owner.`)) {
                
                // Create VIP purchase transaction
                const transaction = {
                    id: Date.now(),
                    userId: currentUser.id,
                    type: 'vip_purchase',
                    vipType: vipType,
                    vipName: vipName,
                    amount: price,
                    bonusPoints: bonusPoints,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                transactions.push(transaction);
                saveTransactions();
                
                closeModal('upgradeModal');
                alert(`Permintaan upgrade ke ${vipName} berhasil dikirim!\n\nMenunggu konfirmasi Owner. Saldo akan dipotong setelah disetujui.`);
            }
        }

        // Account type functions
        function showChangeAccountTypeModal() {
            if (currentUser.role !== 'owner') {
                alert('Hanya owner yang dapat mengubah jenis akun!');
                return;
            }
            document.getElementById('changeAccountTypeModal').classList.remove('hidden');
            document.getElementById('changeAccountTypeModal').classList.add('flex');
        }

        function changeAccountType() {
            const newType = document.getElementById('newAccountType').value;
            
            if (confirm(`Ubah jenis akun menjadi ${getAccountTypeLabel(newType)}?`)) {
                currentUser.accountType = newType;
                
                // Update user in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                users[userIndex] = currentUser;
                
                saveUsers();
                updateUserDisplay();
                closeModal('changeAccountTypeModal');
                
                alert('Jenis akun berhasil diubah!');
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('filaShopCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                // Update current user data from users array
                const updatedUser = users.find(u => u.id === currentUser.id);
                if (updatedUser) {
                    currentUser = updatedUser;
                    showMainApp();
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97711b1496b5fe0d',t:'MTc1NjUyMzUzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
